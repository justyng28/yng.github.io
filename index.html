<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: black;
      overflow: hidden;
      font-family: Pacifico;
      perspective: 1500px;
      touch-action: none;
    }
    #world {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      cursor: grab;
    }
    #world:active {
      cursor: grabbing;
    }
    .text {
      position: absolute;
      color: white;
      font-weight: 600;
      white-space: nowrap;
      pointer-events: none;
      user-select: none;
      text-shadow:
        0 0 5px #ff69b4,
        0 0 10px #ff1493,
        0 0 20px #ff1493,
        0 0 30px #c71585;
      will-change: transform, opacity;
    }
    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      opacity: 0.4;
      pointer-events: none;
      will-change: transform, opacity;
    }

    @media (max-width: 768px) {
      .text {
        font-size: 3vw !important;
      }
    }
  </style>
</head>
<body>
  <div id="world"></div>

<script>
  const world = document.getElementById('world');
  const words = [
    "♡", "☆", "✦",
    "Phía sau ấy, luôn có tôi ở đó chờ chị.", "Chờ xíu đi, cho tôi đi cùng chị.", "Ăn gì xinh với giỏi thế? Bày tôi với.",
    "Hmm, làm sao để tôi có được chị nhỉ?", "Không biết là chị có thích tôi không nhỉ? Tò mò quá đi.",
    "Ở nơi không có tôi, không được khóc nhè đâu đấy nhé!", "Mở lòng ra rồi bỏ tôi vào đi!", "Nói yêu tôi một lần đi, tôi nguyện theo chị cả đời.",
  ];

  const COUNT_TEXT = 600;
  const COUNT_STAR = 180;
  const RADIUS = 1500;

  const texts = [], stars = [], hearts = [];

  function randomRange(min, max) {
    return Math.random() * (max - min) + min;
  }

  function randomPointInSphere(radius) {
    const u = Math.random();
    const v = Math.random();
    const theta = 2 * Math.PI * u;
    const phi = Math.acos(2 * v - 1);
    const r = Math.cbrt(Math.random()) * radius;
    return {
      x: r * Math.sin(phi) * Math.cos(theta),
      y: r * Math.sin(phi) * Math.sin(theta),
      z: r * Math.cos(phi)
    };
  }

  for (let i = 0; i < COUNT_TEXT; i++) {
    const el = document.createElement('div');
    el.className = 'text';
    el.innerText = words[Math.floor(Math.random() * words.length)];
    el.style.fontSize = randomRange(14, 24) + "px";
    world.appendChild(el);

    const pos = randomPointInSphere(RADIUS);
    texts.push({
      el,
      x: pos.x, y: pos.y, z: pos.z,
      speed: randomRange(0.4, 1),
    });
  }

  for (let i = 0; i < COUNT_STAR; i++) {
    const el = document.createElement('div');
    el.className = 'star';
    const size = randomRange(2, 6);
    el.style.width = size + 'px';
    el.style.height = size + 'px';
    world.appendChild(el);

    const pos = randomPointInSphere(RADIUS);
    stars.push({
      el,
      x: pos.x, y: pos.y, z: pos.z,
      size,
      rotateAngle: Math.random() * 360,
      rotateSpeed: randomRange(0.1, 0.3)
    });
  }

  let rotateX = 15, rotateY = 0;
  let isDragging = false, lastX = 0, lastY = 0;

  // PC
  document.addEventListener('mousedown', e => {
    isDragging = true;
    lastX = e.clientX;
    lastY = e.clientY;
  });
  document.addEventListener('mouseup', () => isDragging = false);
  document.addEventListener('mousemove', e => {
    if (isDragging) {
      const dx = e.clientX - lastX;
      const dy = e.clientY - lastY;
      lastX = e.clientX;
      lastY = e.clientY;
      rotateY += dx * 0.3;
      rotateX -= dy * 0.3;
      rotateX = Math.min(Math.max(rotateX, -90), 90);
    }
  });

  // MOBILE TOUCH
  document.addEventListener('touchstart', e => {
    if (e.touches.length === 1) {
      isDragging = true;
      lastX = e.touches[0].clientX;
      lastY = e.touches[0].clientY;
    }
  }, { passive: false });

  document.addEventListener('touchend', () => {
    isDragging = false;
  }, { passive: false });

  document.addEventListener('touchmove', e => {
    if (isDragging && e.touches.length === 1) {
      const dx = e.touches[0].clientX - lastX;
      const dy = e.touches[0].clientY - lastY;
      lastX = e.touches[0].clientX;
      lastY = e.touches[0].clientY;
      rotateY += dx * 0.3;
      rotateX -= dy * 0.3;
      rotateX = Math.min(Math.max(rotateX, -90), 90);
    }
  }, { passive: false });

  function toRad(deg) {
    return deg * Math.PI / 180;
  }

  function renderElement(obj, type) {
    const perspective = 1500;
    const radX = toRad(rotateX);
    const radY = toRad(rotateY);
    const cosX = Math.cos(radX), sinX = Math.sin(radX);
    const cosY = Math.cos(radY), sinY = Math.sin(radY);

    let x = obj.x, y = obj.y, z = obj.z;

    if (type === 'text' || type === 'heart') obj.y += obj.speed;
    if (obj.y > RADIUS) obj.y = -RADIUS;

    let xr = x * cosY - z * sinY;
    let zr = x * sinY + z * cosY;
    let yr = y * cosX - zr * sinX;
    zr = y * sinX + zr * cosX;

    const scale = perspective / (perspective + zr);
    const screenX = window.innerWidth / 2 + xr * scale;
    const screenY = window.innerHeight / 2 + yr * scale;

    obj.el.style.transform = `translate(-50%, -50%) translate3d(${screenX}px, ${screenY}px, 0) scale(${scale.toFixed(3)})`;
    obj.el.style.opacity = (zr > -perspective * 0.3) ? 1 : 0;

    if (type === 'star') {
      obj.el.style.width = obj.size * scale + 'px';
      obj.el.style.height = obj.size * scale + 'px';
      obj.el.style.opacity = (zr > -perspective * 0.3) ? 0.3 : 0;
    }
  }

  function animate() {
    texts.forEach(t => renderElement(t, 'text'));
    stars.forEach(s => renderElement(s, 'star'));
    hearts.forEach(h => renderElement(h, 'heart'));
    requestAnimationFrame(animate);
  }

  animate();

  window.addEventListener('resize', () => location.reload());
</script>

</body>
</html>
